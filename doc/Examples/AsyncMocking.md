<!-- This file was auto-generated by SweetDoky -->
# Async mocking 

Shows techniques for mocking asynchronous methods using various approaches.

__config__: Unless otherwise specified the `config` parameter is the configuration object for [Demo class](References.md#method-demo-class).<br/>

This class includes methods to mock asynchronous behavior using delegates and tasks.
It demonstrates how to handle common asynchronous scenarios such as dynamic return values or task cancellation.

## Mocking async using call 

Mocks asynchronous methods by providing a delegate that returns a `Task`.
This allows for dynamic logic, such as returning different results based on input or throwing exceptions asynchronously.

```csharp
config.GetAgeAsync(call: (name, _) => name == "Oswald" ? Task.FromResult(53) : throw new UnknownPersonException(name));
```

Using `Task.FromResult` within the delegate is the standard way to return a successful result immediately.

## Mocking async cancellation using call 

Simulates task cancellation by returning a canceled task using `Task.FromCanceled`.
This is essential for testing how the calling code handles `OperationCanceledException`.

```csharp
config.GetAgeAsync(call: (_, token) => Task.FromCanceled<int>(token));
```

By passing the `token` from the delegate to `Task.FromCanceled`, the returned task correctly reflects the cancellation state.

## Mocking async using return 

Provides a simpler way to mock asynchronous results when the return value is static and does not depend on the input arguments.

```csharp
config.GetAgeAsync(returns: Task.FromResult(53));
```

This version of the mock configuration accepts a `Task` directly, which is more concise than using a lambda if no logic is required.

## Mocking async using simple return 

Simplifies the mocking of asynchronous methods by allowing a direct value to be returned as a `Task` or `ValueTask`.
This removes the need to manually wrap results in `Task.FromResult`.

```csharp
config.GetAgeAsync(53);
```

This is the most concise way to mock an async method when the result is a constant value.
The framework automatically handles the task wrapping logic behind the scenes.

